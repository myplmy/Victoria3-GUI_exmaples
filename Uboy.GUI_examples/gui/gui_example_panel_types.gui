############################################
# GUI MODDING TUTORIAL - PANEL TYPES
############################################
# This file defines the actual panel that appears in-game
# Fixed version based on Community Mod Framework patterns

@panel_width = 540
@panel_width_half = 270

types gui_example_panel_types {
    type gui_example_panel = default_block_window {
        name = "gui_example_panel"
        # Panel is visible when 'gui_example_panel_open' variable exists
        visible = "[GetVariableSystem.Exists('gui_example_panel_open')]"

        blockoverride "animation_state_block"{
        }

        blockoverride "window_header_name"{
            raw_text = "gui example panel title"
        }

        blockoverride "header_close_button"{
            # Clear the 'gui_example_panel_open' variable when close button is clicked
            onclick = "[GetVariableSystem.Clear('gui_example_panel_open')]"
        }

        widget = {
            state = {
                # Auto-close this panel when another panel opens
                trigger_when = "[InformationPanelBar.IsAnyPanelOpen]"
                on_finish = "[GetVariableSystem.Clear('gui_example_panel_open')]"
            }
        }

        # Main content area of the panel
        blockoverride "scrollarea_content" {
            container = {
                parentanchor = hcenter
                
                # ========================================
                # TAB 1 CONTENT
                # ========================================
                # Visible when 'gui_tab2_open' variable does not exist (Tab 1 is selected)
                flowcontainer = {
                    visible = "[And(
                        GetVariableSystem.Exists('gui_example_panel_open'),
                        Not(GetVariableSystem.Exists('gui_tab2_open'))
                        )]"
                    using = default_content_fade
                    using = default_list_position
                    margin_bottom = 15
                    direction = vertical
                    spacing = 10
                    
                    ### TEST 1A ###
                    test_container = {}
                    ### TEST END ###
                }
                
                # ========================================
                # TAB 2 CONTENT - Second tab (empty)
                # ========================================
                # Visible when 'gui_tab2_open' variable exists (Tab 2 is selected)
                flowcontainer = {
                    visible = "[And(
                        GetVariableSystem.Exists('gui_example_panel_open'),
                        GetVariableSystem.Exists('gui_tab2_open')
                        )]"
                    using = default_content_fade
                    using = default_list_position
                    margin_bottom = 15
                    direction = vertical
                    spacing = 10
                    
                    # Add Tab 2 content here
                }
            }
        }
        
        # ========================================
        # TAB BUTTONS DEFINITION
        # ========================================
        blockoverride "fixed_top" {
            tab_buttons = {
                # Tab 1 Button
                blockoverride "first_button" {
                    text = "Tab 1"
                }
                blockoverride "first_button_tooltip" {
                    tooltip = "Tab 1"
                }
                blockoverride "first_button_click" {
                    # Clear 'gui_tab2_open' variable to switch to Tab 1
                    onclick = "[GetVariableSystem.Clear('gui_tab2_open')]"
                }
                # Display when Tab 1 is selected (gui_tab2_open does not exist)
                blockoverride "first_button_visibility" {
                    visible = "[Not(GetVariableSystem.Exists('gui_tab2_open'))]"
                }
                # Display when Tab 1 is not selected (gui_tab2_open exists)
                blockoverride "first_button_visibility_checked" {
                    visible = "[GetVariableSystem.Exists('gui_tab2_open')]"
                }
                blockoverride "first_button_selected" {
                    text = "Tab 1"
                }
                
                # Tab 2 Button
                blockoverride "second_button" {
                    text = "Tab 2"
                }
                blockoverride "second_button_tooltip" {
                    tooltip = "Tab 2"
                }
                blockoverride "second_button_click" {
                    # Set 'gui_tab2_open' variable to switch to Tab 2
                    onclick = "[GetVariableSystem.Set('gui_tab2_open','tab2')]"
                }
                # Display when Tab 2 is selected (gui_tab2_open exists)
                blockoverride "second_button_visibility" {
                    visible = "[GetVariableSystem.Exists('gui_tab2_open')]"
                }
                # Display when Tab 2 is not selected (gui_tab2_open does not exist)
                blockoverride "second_button_visibility_checked" {
                    visible = "[Not(GetVariableSystem.Exists('gui_tab2_open'))]"
                }
                blockoverride "second_button_selected" {
                    text = "Tab 2"
                }
            }
        }
    }
}
#    type gui_example_panel = default_block_window {
#        name = "gui_example_panel"
#        
#        # Layer is important - determines draw order
#        layer = layer_ingame_menu
#        
#        # FIXED: Proper animation state block following CMF pattern
#        blockoverride "animation_state_block" {
#            state = {
#                name = _show
#                # Close other panels when this one opens
#                on_finish = "[InformationPanelBar.ClosePanel]"
#                on_finish = "[MapListPanelManager.CloseCurrentPanel]"
#                # Optional: Add opening sound
#                start_sound = {
#                    soundeffect = "event:/SFX/UI/SideBar/politics"
#                }
#            }
#            state = {
#                name = _hide
#                # Optional: Add closing sound
#                start_sound = {
#                    soundeffect = "event:/SFX/UI/SideBar/politics_stop"
#                }
#            }
#        }
#        
#        # Close button functionality
#        blockoverride "header_close_button" {
#            visible = yes
#            onclick = "[InformationPanelBar.ClosePanel]"
#        }
#        
#        # Panel title
#        blockoverride "window_header_name" {
#            raw_text = "GUI Modding Tutorial"
#        }
#        
#        # Main content area
#        blockoverride "scrollarea_content" {
#            flowcontainer = {
#                direction = vertical
#                spacing = 20
#                minimumsize = { @panel_width -1 }
#                
#                # Section 1: Basic Text
#                widget = {
#                    size = { @panel_width 100 }
#                    
#                    background = {
#                        using = default_background
#                    }
#                    
#                    textbox = {
#                        parentanchor = center
#                        raw_text = "Welcome to GUI Modding Tutorial!\n\nThis panel demonstrates basic GUI elements."
#                        align = center
#                        multiline = yes
#                        autoresize = yes
#                        maximumsize = { 480 -1 }
#                    }
#                }
#                
#                # Section 2: Button Example
#                button = {
#                    size = { 200 40 }
#                    using = default_button
#                    parentanchor = hcenter
#                    
#                    onclick = "[InformationPanelBar.ClosePanel]"
#                    
#                    textbox = {
#                        parentanchor = center
#                        raw_text = "Close Panel"
#                        align = center|nobaseline
#                    }
#                }
#                
#                # Section 3: Info Box
#                widget = {
#                    size = { @panel_width 80 }
#                    
#                    background = {
#                        using = entry_bg_simple
#                    }
#                    
#                    textbox = {
#                        parentanchor = center
#                        raw_text = "Panel is working correctly!\nIf you can see this, the fix succeeded."
#                        align = center
#                        multiline = yes
#                        autoresize = yes
#                        maximumsize = { 480 -1 }
#                    }
#                }
#            }
#        }
#    }
